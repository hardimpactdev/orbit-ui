import{c as oe,Y as re,d as ue,D as Q,m as ne,a as v,h as s,u as l,i as ie,b as t,t as d,p as de,n as w,e as i,g as _,f as z,w as u,o as n,F as U,j as X,N as ve,z as ce,C as me,a0 as pe,l as fe,$ as xe,r as f,q as A,x as _e}from"./app-qzxdZ0Sx.js";import{Y as Z,A as V,q,k as L,B as m,$ as R,I as ee}from"./craft-ui-BBJ4mG5q.js";import{L as E}from"./loader-circle-DrdtadJK.js";import{C as ge}from"./circle-alert-8X9z5elD.js";import{C as be}from"./copy-COChfNVY.js";const ye=oe("git-fork",[["circle",{cx:"12",cy:"18",r:"3",key:"1mpf1b"}],["circle",{cx:"6",cy:"6",r:"3",key:"1lh9wr"}],["circle",{cx:"18",cy:"6",r:"3",key:"1h7g24"}],["path",{d:"M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9",key:"1uq4wg"}],["path",{d:"M12 12v3",key:"158kv8"}]]),he=re("github",{state:()=>({selectedOrg:null}),actions:{setSelectedOrg(j){this.selectedOrg=j}},persist:{key:"orbit-github",pick:["selectedOrg"]}}),ke={class:"mb-8"},we={class:"text-zinc-400 mt-1"},ze={class:"grid grid-cols-2 gap-8 py-6"},Ce={key:0,class:"mt-1 text-xs text-zinc-500"},Se={class:"font-mono text-zinc-400"},Te={class:"grid grid-cols-2 gap-8 py-6"},Pe={key:0,class:"flex items-center text-zinc-500"},Ve={key:2,class:"text-sm text-zinc-500"},qe={key:3,class:"mt-2 flex items-center gap-2"},Le={key:3,class:"text-xs text-zinc-500"},Re={key:4,class:"text-xs text-lime-400"},je=["href"],Oe={key:6,class:"text-xs text-amber-400"},De={class:"grid grid-cols-2 gap-8 py-6"},Fe={key:0,class:"flex items-center text-zinc-500 mt-2"},$e={key:1,class:"flex items-center gap-2 mt-2"},He={key:0,class:"text-xs px-2 py-0.5 rounded-full bg-zinc-700 text-zinc-400"},Ne={key:1,class:"text-xs px-2 py-0.5 rounded-full bg-purple-500/10 text-purple-400 border border-purple-500/20"},Ue={key:2,class:"text-xs text-zinc-500"},Ae={key:2,class:"mt-4 p-4 bg-zinc-800/50 border border-zinc-700 rounded-lg"},Ee={class:"flex gap-3"},Me={class:"flex items-center gap-2 mb-1"},Ye={class:"flex items-center gap-2 mb-1"},Ge={key:3,class:"text-xs text-amber-400 mt-2"},Be={key:4,class:"mt-3"},Ke={class:"flex flex-wrap gap-2"},Qe=["onClick"],Ie={class:"py-6"},We={key:0,class:"mt-4 space-y-6"},Je={class:"grid grid-cols-2 gap-8"},Xe={class:"text-sm text-zinc-500 mt-1"},Ze={key:0},et={key:1},tt={class:"grid grid-cols-2 gap-8"},lt={class:"text-sm text-zinc-500 mt-1"},st={class:"text-zinc-400"},at={class:"grid grid-cols-2 gap-8"},ot={class:"text-sm text-zinc-500 mt-1"},rt={class:"text-zinc-400"},ut={class:"grid grid-cols-2 gap-8"},nt={class:"text-sm text-zinc-500 mt-1"},it={class:"text-zinc-400"},dt={class:"grid grid-cols-2 gap-8"},vt={class:"text-sm text-zinc-500 mt-1"},ct={class:"text-zinc-400"},mt={key:1,class:"mt-6"},pt={class:"p-4 bg-red-400/10 border border-red-400/20 rounded-lg"},ft={class:"text-red-400"},xt={class:"flex justify-end gap-3 pt-6 mt-6 border-t border-zinc-800"},kt=ue({__name:"ProjectCreate",props:{environment:{},recentTemplates:{}},setup(j){const M=he(),a=f({name:"",template:"",is_template:!1,fork:!1,visibility:"private",php_version:null,db_driver:null,session_driver:null,cache_driver:null,queue_driver:null}),D=f(!1),F=f(null),g=f(null),Y=f([]),G=f(!1),p=f(null),b=f(null),C=f(!1),S=f(null);let T=null;const O=r=>r.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,""),$=A(()=>!p.value||!a.value.name?null:`${p.value}/${O(a.value.name)}`),te=A(()=>{if(!a.value.template)return null;const r=a.value.template.match(/(?:github\.com\/)?([^/]+\/[^/\s]+?)(?:\.git)?$/i);return r?r[1].toLowerCase():null}),I=A(()=>{if(!a.value.template||a.value.is_template||!p.value||!a.value.name)return!1;const r=O(a.value.name),e=`${p.value}/${r}`.toLowerCase();return te.value!==e}),W=A(()=>!(!a.value.name.trim()||C.value||b.value===!0||D.value)),P=f(!1),x=f(null),c=f(null),B=f(!1),h=f(null);let K=null;const k=r=>r?{sqlite:"SQLite",pgsql:"PostgreSQL",mysql:"MySQL",file:"File",database:"Database",redis:"Redis",sync:"Sync",array:"Array"}[r]||r:"Not set";Q(()=>a.value.name,r=>{if(T&&clearTimeout(T),b.value=null,S.value=null,!r||!p.value)return;C.value=!0;const e=p.value,o=r;T=setTimeout(()=>{J(e,o)},500)}),Q(p,r=>{if(M.setSelectedOrg(r?.toLowerCase()??null),r&&a.value.name){b.value=null,S.value=null,C.value=!0,T&&clearTimeout(T);const e=r,o=a.value.name;T=setTimeout(()=>{J(e,o)},300)}});async function J(r,e){if(!r||!e){C.value=!1;return}const o=O(e),y=`${r}/${o}`;try{const N=await(await fetch("/github-repo-exists",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({repo:y})})).json();N.success?(b.value=N.exists,S.value=N.error||null):S.value=N.error||"Failed to check repository"}catch(H){console.error("Failed to check repo:",H),S.value="Failed to check repository availability"}finally{C.value=!1}}Q(()=>a.value.template,r=>{if(K&&clearTimeout(K),!r){x.value=null,c.value=null,a.value.is_template=!1,h.value=null;return}K=setTimeout(()=>{le(r)},500)});const le=async r=>{B.value=!0,h.value=null;try{const o=await(await fetch("/template-defaults",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||""},body:JSON.stringify({template:r})})).json();if(o.success&&o.data){const y=o.data.drivers||o.data;x.value=y,c.value=o.data.metadata||{is_template:o.data.is_template||!1,framework:o.data.type||"unknown",default_branch:"main",repo:r},a.value.is_template=o.data.is_template||!1,c.value?.recommended_php_version&&(a.value.php_version=c.value.recommended_php_version),(y.db_driver||y.session_driver||y.cache_driver||y.queue_driver)&&(P.value=!0)}else h.value=o.error||"Could not fetch repository info",x.value=null,c.value=null,a.value.is_template=!1}catch(e){console.error("Failed to fetch repository info:",e),h.value="Failed to fetch repository info",x.value=null,c.value=null,a.value.is_template=!1}finally{B.value=!1}};ne(async()=>{G.value=!0;try{const[r,e]=await Promise.all([fetch("/github-user").then(o=>o.json()),fetch("/github-orgs").then(o=>o.json())]);if(r.success&&r.user&&(g.value=r.user.toLowerCase()),e.success&&e.data&&(Y.value=e.data),M.selectedOrg){const o=M.selectedOrg.toLowerCase();[g.value?.toLowerCase(),...Y.value.map(H=>H.login.toLowerCase())].includes(o)?p.value=o:p.value=g.value}else p.value=g.value}catch(r){console.error("Failed to fetch GitHub data:",r);try{const e=await fetch("/github-user").then(o=>o.json());e.success&&e.user&&(g.value=e.user.toLowerCase(),p.value=g.value)}catch{}}finally{G.value=!1}});const se=r=>{a.value.template=r.repo_url,(r.db_driver||r.session_driver||r.cache_driver||r.queue_driver)&&(a.value.db_driver=r.db_driver,a.value.session_driver=r.session_driver,a.value.cache_driver=r.cache_driver,a.value.queue_driver=r.queue_driver,P.value=!0)},ae=()=>{W.value&&(D.value=!0,F.value=null,_e.post("/projects",{...a.value,org:p.value},{onSuccess:()=>{},onError:r=>{F.value=r.error||r.name||Object.values(r)[0]||"Failed to create project",D.value=!1},onFinish:()=>{}}))};return(r,e)=>(n(),v(U,null,[s(l(ie),{title:"New Project"}),t("div",null,[t("div",ke,[e[11]||(e[11]=t("h1",{class:"text-2xl font-bold text-white"},"New Project",-1)),t("p",we,"Create a new project in "+d(j.environment.name),1)]),t("form",{onSubmit:de(ae,["prevent"])},[t("div",ze,[e[13]||(e[13]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Project Name"),t("p",{class:"text-sm text-zinc-500 mt-1"}," Display name for the project. Will be slugified for the directory and URL. ")],-1)),t("div",null,[s(l(Z),{modelValue:a.value.name,"onUpdate:modelValue":e[0]||(e[0]=o=>a.value.name=o),type:"text",id:"name",required:"",placeholder:"My Awesome Project",class:w(["w-full",{"border-red-500":b.value===!0}])},null,8,["modelValue","class"]),a.value.name&&O(a.value.name)!==a.value.name?(n(),v("p",Ce,[e[12]||(e[12]=i(" Directory: ",-1)),t("span",Se,d(O(a.value.name)),1)])):_("",!0)])]),e[47]||(e[47]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Te,[e[15]||(e[15]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Organization"),t("p",{class:"text-sm text-zinc-500 mt-1"}," GitHub account or organization where the repository will be created. ")],-1)),t("div",null,[G.value?(n(),v("div",Pe,[s(l(E),{class:"w-4 h-4 mr-2 animate-spin"}),e[14]||(e[14]=t("span",{class:"text-sm"},"Loading organizations...",-1))])):g.value?(n(),z(l(R),{key:1,"model-value":p.value,"onUpdate:modelValue":e[1]||(e[1]=o=>p.value=o)},{default:u(()=>[s(l(V),{class:"w-full"},{default:u(()=>[s(l(q),{placeholder:"Select organization"})]),_:1}),s(l(L),null,{default:u(()=>[s(l(m),{value:g.value},{default:u(()=>[i(d(g.value)+" (Personal) ",1)]),_:1},8,["value"]),(n(!0),v(U,null,X(Y.value,o=>(n(),z(l(m),{key:o.login,value:o.login.toLowerCase()},{default:u(()=>[i(d(o.login),1)]),_:2},1032,["value"]))),128))]),_:1})]),_:1},8,["model-value"])):(n(),v("div",Ve," Unable to load GitHub account ")),a.value.name&&p.value?(n(),v("div",qe,[C.value?(n(),z(l(E),{key:0,class:"w-3.5 h-3.5 animate-spin text-zinc-500"})):b.value===!1?(n(),z(l(ve),{key:1,class:"w-3.5 h-3.5 text-lime-400"})):b.value===!0?(n(),z(l(ge),{key:2,class:"w-3.5 h-3.5 text-red-400"})):_("",!0),C.value?(n(),v("span",Le," Checking "+d($.value)+"... ",1)):b.value===!1?(n(),v("span",Re,d($.value)+" is available ",1)):b.value===!0?(n(),v("a",{key:5,href:`https://github.com/${$.value}`,target:"_blank",class:"text-xs text-red-400 hover:underline"},d($.value)+" already exists ",9,je)):S.value?(n(),v("span",Oe,d(S.value),1)):_("",!0)])):_("",!0)])]),e[48]||(e[48]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",De,[e[21]||(e[21]=t("div",null,[t("h3",{class:"text-sm font-medium text-white"},"Repository"),t("p",{class:"text-sm text-zinc-500 mt-1"}," GitHub repository to use as a starting point. ")],-1)),t("div",null,[s(l(Z),{modelValue:a.value.template,"onUpdate:modelValue":e[2]||(e[2]=o=>a.value.template=o),type:"text",id:"template",placeholder:"owner/repo or https://github.com/owner/repo",class:"w-full"},null,8,["modelValue"]),B.value?(n(),v("div",Fe,[s(l(E),{class:"w-3 h-3 mr-1.5 animate-spin"}),e[16]||(e[16]=t("span",{class:"text-xs"},"Analyzing repository...",-1))])):c.value&&!h.value?(n(),v("div",$e,[t("span",{class:w(["text-xs px-2 py-0.5 rounded-full",c.value.is_template?"bg-lime-500/10 text-lime-400 border border-lime-500/20":"bg-blue-500/10 text-blue-400 border border-blue-500/20"])},d(c.value.is_template?"Template":"Repository"),3),c.value.framework!=="unknown"?(n(),v("span",He,d(c.value.framework),1)):_("",!0),c.value.recommended_php_version?(n(),v("span",Ne," PHP "+d(c.value.recommended_php_version),1)):_("",!0),I.value?_("",!0):(n(),v("span",Ue,d(c.value.is_template?"Will create new repo from template":"Will clone directly"),1))])):_("",!0),I.value&&c.value&&!h.value?(n(),v("div",Ae,[e[19]||(e[19]=t("p",{class:"text-sm text-zinc-400 mb-3"}," This repository belongs to someone else. How would you like to use it? ",-1)),t("div",Ee,[t("button",{type:"button",onClick:e[3]||(e[3]=o=>a.value.fork=!0),class:w(["flex-1 p-3 rounded-lg border-2 transition-colors text-left",a.value.fork?"border-lime-500 bg-lime-500/10":"border-zinc-700 hover:border-zinc-600"])},[t("div",Me,[s(l(ye),{class:w(["w-4 h-4",a.value.fork?"text-lime-400":"text-zinc-400"])},null,8,["class"]),t("span",{class:w(["text-sm font-medium",a.value.fork?"text-lime-400":"text-white"])},"Fork",2)]),e[17]||(e[17]=t("p",{class:"text-xs text-zinc-500"}," Create a fork linked to the original repository ",-1))],2),t("button",{type:"button",onClick:e[4]||(e[4]=o=>a.value.fork=!1),class:w(["flex-1 p-3 rounded-lg border-2 transition-colors text-left",a.value.fork?"border-zinc-700 hover:border-zinc-600":"border-lime-500 bg-lime-500/10"])},[t("div",Ye,[s(l(be),{class:w(["w-4 h-4",a.value.fork?"text-zinc-400":"text-lime-400"])},null,8,["class"]),t("span",{class:w(["text-sm font-medium",a.value.fork?"text-white":"text-lime-400"])},"Import",2)]),e[18]||(e[18]=t("p",{class:"text-xs text-zinc-500"}," Create an independent copy with no link to original ",-1))],2)])])):h.value&&a.value.template?(n(),v("div",Ge,d(h.value),1)):_("",!0),j.recentTemplates.length>0?(n(),v("div",Be,[e[20]||(e[20]=t("p",{class:"text-xs text-zinc-500 mb-2"},"Recent templates:",-1)),t("div",Ke,[(n(!0),v(U,null,X(j.recentTemplates,o=>(n(),v("button",{key:o.id,type:"button",onClick:y=>se(o),class:"px-2 py-1 text-xs bg-zinc-700 text-zinc-400 rounded hover:bg-zinc-600 hover:text-white transition-colors"},d(o.display_name),9,Qe))),128))])])):_("",!0)])]),x.value?(n(),v(U,{key:0},[e[44]||(e[44]=t("hr",{class:"border-zinc-800"},null,-1)),t("div",Ie,[t("button",{type:"button",onClick:e[5]||(e[5]=o=>P.value=!P.value),class:"flex items-center gap-2 text-sm font-medium text-zinc-400 hover:text-white transition-colors"},[(n(),z(ce(P.value?l(me):l(pe)),{class:"w-4 h-4"})),e[22]||(e[22]=i(" Configuration Options ",-1)),e[23]||(e[23]=t("span",{class:"text-xs text-zinc-500"},"(from template)",-1))]),P.value?(n(),v("div",We,[t("div",Je,[t("div",null,[e[24]||(e[24]=t("h3",{class:"text-sm font-medium text-white"},"PHP Version",-1)),t("p",Xe,[c.value?.min_php_version?(n(),v("span",Ze,"Minimum: PHP "+d(c.value.min_php_version)+"+",1)):(n(),v("span",et,"Using latest PHP version"))])]),t("div",null,[s(l(R),{modelValue:a.value.php_version,"onUpdate:modelValue":e[6]||(e[6]=o=>a.value.php_version=o)},{default:u(()=>[s(l(V),{class:"w-full"},{default:u(()=>[s(l(q),{placeholder:"Select PHP version"})]),_:1}),s(l(L),null,{default:u(()=>[s(l(m),{value:null},{default:u(()=>[i(" Auto-detect ("+d(c.value?.recommended_php_version||"8.5")+") ",1)]),_:1}),s(l(m),{value:"8.5"},{default:u(()=>[i(" PHP 8.5"+d(c.value?.recommended_php_version==="8.5"?" (Recommended)":""),1)]),_:1}),s(l(m),{value:"8.4"},{default:u(()=>[i(" PHP 8.4"+d(c.value?.recommended_php_version==="8.4"?" (Recommended)":""),1)]),_:1}),s(l(m),{value:"8.3"},{default:u(()=>[i(" PHP 8.3"+d(c.value?.recommended_php_version==="8.3"?" (Recommended)":""),1)]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",tt,[t("div",null,[e[26]||(e[26]=t("h3",{class:"text-sm font-medium text-white"},"Database",-1)),t("p",lt,[e[25]||(e[25]=i(" Template default: ",-1)),t("span",st,d(k(x.value.db_driver)),1)])]),t("div",null,[s(l(R),{modelValue:a.value.db_driver,"onUpdate:modelValue":e[7]||(e[7]=o=>a.value.db_driver=o)},{default:u(()=>[s(l(V),{class:"w-full"},{default:u(()=>[s(l(q),{placeholder:"Select database"})]),_:1}),s(l(L),null,{default:u(()=>[s(l(m),{value:null},{default:u(()=>[i(" Keep Default ("+d(k(x.value.db_driver))+") ",1)]),_:1}),s(l(m),{value:"sqlite"},{default:u(()=>[...e[27]||(e[27]=[i("SQLite",-1)])]),_:1}),s(l(m),{value:"pgsql"},{default:u(()=>[...e[28]||(e[28]=[i("PostgreSQL",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",at,[t("div",null,[e[30]||(e[30]=t("h3",{class:"text-sm font-medium text-white"},"Session",-1)),t("p",ot,[e[29]||(e[29]=i(" Template default: ",-1)),t("span",rt,d(k(x.value.session_driver)),1)])]),t("div",null,[s(l(R),{modelValue:a.value.session_driver,"onUpdate:modelValue":e[8]||(e[8]=o=>a.value.session_driver=o)},{default:u(()=>[s(l(V),{class:"w-full"},{default:u(()=>[s(l(q),{placeholder:"Select session driver"})]),_:1}),s(l(L),null,{default:u(()=>[s(l(m),{value:null},{default:u(()=>[i(" Keep Default ("+d(k(x.value.session_driver))+") ",1)]),_:1}),s(l(m),{value:"file"},{default:u(()=>[...e[31]||(e[31]=[i("File",-1)])]),_:1}),s(l(m),{value:"database"},{default:u(()=>[...e[32]||(e[32]=[i("Database",-1)])]),_:1}),s(l(m),{value:"redis"},{default:u(()=>[...e[33]||(e[33]=[i("Redis",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",ut,[t("div",null,[e[35]||(e[35]=t("h3",{class:"text-sm font-medium text-white"},"Cache",-1)),t("p",nt,[e[34]||(e[34]=i(" Template default: ",-1)),t("span",it,d(k(x.value.cache_driver)),1)])]),t("div",null,[s(l(R),{modelValue:a.value.cache_driver,"onUpdate:modelValue":e[9]||(e[9]=o=>a.value.cache_driver=o)},{default:u(()=>[s(l(V),{class:"w-full"},{default:u(()=>[s(l(q),{placeholder:"Select cache driver"})]),_:1}),s(l(L),null,{default:u(()=>[s(l(m),{value:null},{default:u(()=>[i(" Keep Default ("+d(k(x.value.cache_driver))+") ",1)]),_:1}),s(l(m),{value:"file"},{default:u(()=>[...e[36]||(e[36]=[i("File",-1)])]),_:1}),s(l(m),{value:"database"},{default:u(()=>[...e[37]||(e[37]=[i("Database",-1)])]),_:1}),s(l(m),{value:"redis"},{default:u(()=>[...e[38]||(e[38]=[i("Redis",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),t("div",dt,[t("div",null,[e[40]||(e[40]=t("h3",{class:"text-sm font-medium text-white"},"Queue",-1)),t("p",vt,[e[39]||(e[39]=i(" Template default: ",-1)),t("span",ct,d(k(x.value.queue_driver)),1)])]),t("div",null,[s(l(R),{modelValue:a.value.queue_driver,"onUpdate:modelValue":e[10]||(e[10]=o=>a.value.queue_driver=o)},{default:u(()=>[s(l(V),{class:"w-full"},{default:u(()=>[s(l(q),{placeholder:"Select queue driver"})]),_:1}),s(l(L),null,{default:u(()=>[s(l(m),{value:null},{default:u(()=>[i(" Keep Default ("+d(k(x.value.queue_driver))+") ",1)]),_:1}),s(l(m),{value:"sync"},{default:u(()=>[...e[41]||(e[41]=[i("Sync",-1)])]),_:1}),s(l(m),{value:"database"},{default:u(()=>[...e[42]||(e[42]=[i("Database",-1)])]),_:1}),s(l(m),{value:"redis"},{default:u(()=>[...e[43]||(e[43]=[i("Redis",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue"])])])])):_("",!0)])],64)):_("",!0),F.value?(n(),v("div",mt,[t("div",pt,[t("p",ft,d(F.value),1)])])):_("",!0),t("div",xt,[s(l(ee),{"as-child":"",variant:"ghost"},{default:u(()=>[s(l(fe),{href:"/projects"},{default:u(()=>[...e[45]||(e[45]=[i(" Cancel ",-1)])]),_:1})]),_:1}),s(l(ee),{type:"submit",disabled:!W.value,variant:"secondary"},{default:u(()=>[D.value?(n(),z(l(E),{key:0,class:"w-4 h-4 animate-spin"})):(n(),z(l(xe),{key:1,class:"w-4 h-4"})),e[46]||(e[46]=i(" Create Project ",-1))]),_:1},8,["disabled"])])],32)])],64))}});export{kt as default};
